<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Timer</title>
    <style>
        #timer {
            font-size:xx-large
        }
    </style>
</head>
<body>
    <h1>Simple Lockdown Timer</h1>
    <div id="timerControls">
    <select id="choosing">
        <option value=3600>1 hour</option>
        <option value=5400>1.5 hours</option>
        <option value=7200>2 hours</option>
        <option value=9000>2.5 hours</option>
        <option value=10800>3 hours</option>
        </select>
    </div>
    <p id="timer"></p>
    <p id="WarningMessage"></p>
    <button id="start" hidden = true>Start!</button>
    <script>
        let totalSeconds = 0

        function varyValue(chosenValue) {
            console.log("A setting has changed!")
            totalSeconds = Number(chosenValue);
            updateTimerDisplay();
            document.getElementById("start").hidden = false;
        }

        async function delay(seconds) {
            return new Promise(resolve => setTimeout(resolve, seconds));
        }

        function updateTimerDisplay() {
        const hours = Math.floor(totalSeconds / 3600)
        const minutes = Math.floor(totalSeconds % 3600 / 60);
        const seconds = totalSeconds % 60;
        document.getElementById("timer").textContent =
            String(hours).padStart(2, "0") + ":" + String(minutes).padStart(2, "0") + ":" + String(seconds).padStart(2, "0");
        }

        async function countdown() {
            document.getElementById("timerControls").hidden = true;
            document.getElementById("start").hidden = true;
            while (true) {
                if (totalSeconds <= 0) {
                    document.getElementById("WarningMessage").textContent = "Time is up!!!";
                    await delay(3000);
                    window.location.href = "finish.html"
                    return;
                }
                if (totalSeconds === 900) {
                    document.getElementById("WarningMessage").textContent = "15 minutes remain.";
                }
                if (totalSeconds === 300) {
                    document.getElementById("WarningMessage").textContent = "5 minutes remain.";
                }
                totalSeconds--;
                await delay(1000);
                updateTimerDisplay();
            }
        }
        document.getElementById("start").addEventListener("click", countdown);
        document.getElementById("choosing").addEventListener("click", function(event) {
            varyValue(event.target.value);
        });
    </script>
</body>
</html>
